<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Summary</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
      body { background:#f8f9fa; }
      .page-title { margin:0; font-size:20px; }
      .table-wrap { width:100%; overflow:auto; -webkit-overflow-scrolling: touch; }
      table.summary-table { width:100%; border-collapse:collapse; background:#fff; }
      table.summary-table th, table.summary-table td { border:1px solid #eee; padding:10px; text-align:left; }
      table.summary-table thead th { position:sticky; top:0; background:#f3f4f6; z-index:2; }
      table.summary-table tbody tr:nth-child(even) { background:#fafafa; }
      .actions { display:flex; gap:12px; justify-content:flex-end; margin-top: 12px; }
      .meta { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; color:#555; }
    </style>
  </head>
  <body>
    <div class="topbar">
      <h1 class="page-title">Extracted Applicant Details</h1>
      <div style="display:flex; gap:8px; align-items:center;">
        <a class="btn" href="/">Home</a>
        <a class="btn" href="/cases/view">Cases</a>
        <a class="btn" href="/logout">Logout</a>
      </div>
    </div>

    <div class="container-narrow">
      <div class="card">
        <div class="meta">
          <div>
            <strong>Total Cases:</strong> {{ items|length if items else 0 }}
          </div>
          <div>
            <a class="btn" href="/export/csv">Extract as CSV</a>
            <button class="btn" onclick="sendToManager()">Send to Manager</button>
          </div>
        </div>
        <div class="table-wrap">
          <table class="summary-table">
            <thead>
              <tr>
                <th>Case ID</th>
                {% for h in headers %}
                  <th>{{ h }}</th>
                {% endfor %}
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% if items %}
                {% for row in items %}
                  <tr>
                    <td>{{ row.case_id }}</td>
                    {% for h in headers %}
                      <td>{{ row.fields[h] }}</td>
                    {% endfor %}
                    <td>{{ row.status or 'Pending' }}</td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="{{ 2 + headers|length }}" class="muted">No cases yet.</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      function sendToManager() {
        const a = document.createElement('a');
        a.href = '/export/csv';
        a.download = 'pdo_cases.csv';
        document.body.appendChild(a);
        a.click();
        a.remove();
        alert('CSV prepared. Share with Manager as needed.');
      }
    </script>
  </body>
  </html>
